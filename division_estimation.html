<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å•†ã®è¦‹ç«‹ã¦ãƒãƒˆãƒ« - ã•ã•ã£ã¨ç®—æ•°</title>
    <link href="https://fonts.googleapis.com/css2?family=Kiwi+Maru:wght@500&family=M+PLUS+Rounded+1c:wght@800&display=swap" rel="stylesheet">
    <style>
        :root {
            --orange: #FF9AA2;
            --yellow: #FFDAC1;
            --light-green: #E2F0CB;
            --light-blue: #B5EAD7;
            --text: #6B5B95;
            --white: #FFFFF0;
            --font-main: 'M PLUS Rounded 1c', sans-serif;
            --font-title: 'Kiwi Maru', serif;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-main);
            background: linear-gradient(135deg, var(--light-green) 0%, var(--light-blue) 100%);
            background-image:
                radial-gradient(rgba(255,255,255,0.3) 15%, transparent 16%),
                radial-gradient(rgba(255,255,255,0.3) 15%, transparent 16%);
            background-size: 40px 40px;
            background-position: 0 0, 20px 20px;
            min-height: 100vh;
            padding: 20px;
            color: var(--text);
            overflow-x: hidden;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        /* ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ */
        .title-screen {
            text-align: center;
            padding: 40px 20px;
        }

        .game-title {
            font-family: var(--font-title);
            font-size: 3rem;
            color: var(--text);
            text-shadow: 3px 3px 0 var(--white);
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .game-subtitle {
            font-size: 1.3rem;
            color: var(--text);
            margin-bottom: 40px;
            line-height: 1.8;
        }

        .start-button, .next-button, .back-button {
            background: linear-gradient(135deg, var(--orange) 0%, #FF8A95 100%);
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            padding: 20px 60px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 6px 0 #E07A86;
            transition: all 0.2s;
            margin: 10px;
        }

        .start-button:hover, .next-button:hover, .back-button:hover {
            transform: translateY(3px);
            box-shadow: 0 3px 0 #E07A86;
        }

        .start-button:active, .next-button:active, .back-button:active {
            transform: translateY(6px);
            box-shadow: none;
        }

        .back-button {
            background: linear-gradient(135deg, var(--light-blue) 0%, #A0D9C4 100%);
            box-shadow: 0 6px 0 #8AC4AF;
            font-size: 1.2rem;
            padding: 15px 40px;
        }

        .back-button:hover {
            box-shadow: 0 3px 0 #8AC4AF;
        }

        /* ã‚²ãƒ¼ãƒ ç”»é¢ */
        .game-screen {
            display: none;
        }

        .score-board {
            background: var(--white);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 15px;
        }

        .score-item {
            text-align: center;
        }

        .score-label {
            font-size: 0.9rem;
            color: var(--text);
            opacity: 0.7;
            margin-bottom: 5px;
        }

        .score-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--text);
        }

        /* ãƒãƒˆãƒ«ç”»é¢ */
        .battle-area {
            background: var(--white);
            border-radius: 20px;
            padding: 40px 20px;
            margin-bottom: 30px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
            text-align: center;
        }

        .monster {
            margin-bottom: 30px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-15px); }
        }

        .monster-icon {
            font-size: 6rem;
            margin-bottom: 15px;
        }

        .hp-label {
            font-size: 1.2rem;
            color: var(--text);
            margin-bottom: 10px;
        }

        .hp-value {
            font-size: 4rem;
            font-weight: bold;
            color: var(--orange);
            text-shadow: 2px 2px 0 rgba(0,0,0,0.1);
        }

        .vs-divider {
            font-size: 2rem;
            font-weight: bold;
            color: var(--text);
            margin: 30px 0;
        }

        .attack-section {
            margin-bottom: 30px;
        }

        .attack-label {
            font-size: 1.2rem;
            color: var(--text);
            margin-bottom: 10px;
        }

        .attack-value {
            font-size: 3rem;
            font-weight: bold;
            color: var(--light-blue);
            text-shadow: 2px 2px 0 rgba(0,0,0,0.1);
        }

        /* å…¥åŠ›ã‚¨ãƒªã‚¢ */
        .input-area {
            background: var(--yellow);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .input-label {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--text);
            margin-bottom: 20px;
            text-align: center;
        }

        .input-group {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .answer-input {
            font-family: var(--font-main);
            font-size: 3rem;
            font-weight: bold;
            text-align: center;
            width: 200px;
            padding: 15px;
            border: 4px solid var(--text);
            border-radius: 15px;
            background: white;
            color: var(--text);
        }

        .answer-input:focus {
            outline: none;
            border-color: var(--orange);
            box-shadow: 0 0 0 4px rgba(255, 154, 162, 0.3);
        }

        .times-label {
            font-size: 2rem;
            font-weight: bold;
            color: var(--text);
        }

        .submit-button {
            background: linear-gradient(135deg, #FF6B6B 0%, #FF5252 100%);
            color: white;
            font-size: 1.8rem;
            font-weight: bold;
            padding: 20px 50px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 6px 0 #D84343;
            transition: all 0.2s;
            display: block;
            margin: 0 auto;
        }

        .submit-button:hover {
            transform: translateY(3px);
            box-shadow: 0 3px 0 #D84343;
        }

        .submit-button:active {
            transform: translateY(6px);
            box-shadow: none;
        }

        .submit-button:disabled {
            background: #CCC;
            box-shadow: 0 6px 0 #AAA;
            cursor: not-allowed;
        }

        /* ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ */
        .feedback {
            display: none;
            background: var(--white);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-align: center;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .feedback.show {
            display: block;
        }

        .feedback-icon {
            font-size: 5rem;
            margin-bottom: 20px;
        }

        .feedback-title {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .feedback-message {
            font-size: 1.3rem;
            line-height: 1.8;
            margin-bottom: 20px;
        }

        .feedback-explanation {
            background: var(--light-green);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            font-size: 1.2rem;
            line-height: 1.8;
        }

        .feedback-perfect {
            color: #FF6B6B;
        }

        .feedback-good {
            color: #FFA500;
        }

        .feedback-ok {
            color: #4CAF50;
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
        @media (max-width: 768px) {
            .game-title {
                font-size: 2rem;
            }

            .monster-icon {
                font-size: 4rem;
            }

            .hp-value {
                font-size: 3rem;
            }

            .attack-value {
                font-size: 2rem;
            }

            .answer-input {
                font-size: 2rem;
                width: 150px;
            }

            .submit-button {
                font-size: 1.5rem;
                padding: 15px 40px;
            }
        }

        @media (max-width: 480px) {
            .game-title {
                font-size: 1.5rem;
            }

            .answer-input {
                font-size: 1.8rem;
                width: 120px;
            }

            .score-board {
                flex-direction: column;
            }
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ -->
        <div class="title-screen" id="titleScreen">
            <h1 class="game-title">âš”ï¸ å•†ã®è¦‹ç«‹ã¦ãƒãƒˆãƒ« âš”ï¸</h1>
            <p class="game-subtitle">
                ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã®HPã‚’è¦‹ã¦ã€<br>
                ä½•å›æ”»æ’ƒã™ã‚Œã°å€’ã›ã‚‹ã‹è¦‹ç«‹ã¦ã‚ˆã†ï¼<br>
                <strong>ã€Œã ã„ãŸã„ä½•å€ã‹ã€</strong>ã‚’æ„Ÿè¦šã§æ´ã‚€ç·´ç¿’ã ã‚ˆğŸ¯
            </p>
            <button class="start-button" onclick="startGame()">âš”ï¸ ãƒãƒˆãƒ«é–‹å§‹ï¼</button>
            <br>
            <button class="back-button" onclick="location.href='index.html'">ğŸ  ãƒˆãƒƒãƒ—ã«æˆ»ã‚‹</button>
        </div>

        <!-- ã‚²ãƒ¼ãƒ ç”»é¢ -->
        <div class="game-screen" id="gameScreen">
            <!-- ã‚¹ã‚³ã‚¢ãƒœãƒ¼ãƒ‰ -->
            <div class="score-board">
                <div class="score-item">
                    <div class="score-label">é€£ç¶šæ­£è§£</div>
                    <div class="score-value" id="comboCount">0</div>
                </div>
                <div class="score-item">
                    <div class="score-label">â—åˆ¤å®š</div>
                    <div class="score-value" id="perfectCount">0</div>
                </div>
                <div class="score-item">
                    <div class="score-label">â—‹åˆ¤å®š</div>
                    <div class="score-value" id="goodCount">0</div>
                </div>
                <div class="score-item">
                    <div class="score-label">å•é¡Œæ•°</div>
                    <div class="score-value" id="totalCount">0</div>
                </div>
            </div>

            <!-- ãƒãƒˆãƒ«ã‚¨ãƒªã‚¢ -->
            <div class="battle-area">
                <div class="monster">
                    <div class="monster-icon" id="monsterIcon">ğŸ‘¾</div>
                    <div class="hp-label">ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼HP</div>
                    <div class="hp-value" id="hpValue">1234</div>
                </div>

                <div class="vs-divider">Ã·</div>

                <div class="attack-section">
                    <div class="attack-label">ã‚ãªãŸã®æ”»æ’ƒåŠ›</div>
                    <div class="attack-value" id="attackValue">56</div>
                </div>
            </div>

            <!-- å…¥åŠ›ã‚¨ãƒªã‚¢ -->
            <div class="input-area">
                <div class="input-label">ä½•å›æ”»æ’ƒã™ã‚Œã°å€’ã›ã‚‹ï¼Ÿ</div>
                <div class="input-group">
                    <input type="number" class="answer-input" id="answerInput" placeholder="?" min="1" max="9999">
                    <span class="times-label">å›</span>
                </div>
                <button class="submit-button" id="submitButton" onclick="checkAnswer()">âš”ï¸ æ”»æ’ƒã™ã‚‹ï¼</button>
            </div>

            <!-- ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ -->
            <div class="feedback" id="feedback">
                <div class="feedback-icon" id="feedbackIcon">ğŸ‰</div>
                <div class="feedback-title" id="feedbackTitle">å®Œç’§ãªè¦‹ç«‹ã¦ï¼</div>
                <div class="feedback-message" id="feedbackMessage">ç´ æ™´ã‚‰ã—ã„ï¼</div>
                <div class="feedback-explanation" id="feedbackExplanation"></div>
                <button class="next-button" onclick="nextProblem()">æ¬¡ã®å•é¡Œã¸ â–¶</button>
            </div>
        </div>
    </div>

    <script>
        // ã‚²ãƒ¼ãƒ çŠ¶æ…‹
        let gameState = {
            dividend: 0,      // å‰²ã‚‰ã‚Œã‚‹æ•°
            divisor: 0,       // å‰²ã‚‹æ•°
            correctAnswer: 0, // æ­£ã—ã„å•†
            userAnswer: 0,    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å›ç­”
            combo: 0,         // é€£ç¶šæ­£è§£
            perfectCount: 0,  // â—ã®æ•°
            goodCount: 0,     // â—‹ã®æ•°
            totalCount: 0,    // ç·å•é¡Œæ•°
        };

        // ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã®çµµæ–‡å­—ãƒªã‚¹ãƒˆ
        const monsters = ['ğŸ‘¾', 'ğŸ‘¹', 'ğŸ‘º', 'ğŸ‰', 'ğŸ¦–', 'ğŸ¦•', 'ğŸ²', 'ğŸ§Ÿ', 'ğŸ§›'];

        // ã‚²ãƒ¼ãƒ é–‹å§‹
        function startGame() {
            document.getElementById('titleScreen').classList.add('hidden');
            document.getElementById('gameScreen').style.display = 'block';
            loadProgress();
            generateProblem();
        }

        // å•é¡Œç”Ÿæˆ
        function generateProblem() {
            // ãƒ©ãƒ³ãƒ€ãƒ ã§æ¡æ•°ã‚’é¸æŠ
            const types = [
                { dividendDigits: 2, divisorDigits: 2 }, // 2æ¡Ã·2æ¡
                { dividendDigits: 3, divisorDigits: 2 }, // 3æ¡Ã·2æ¡
                { dividendDigits: 4, divisorDigits: 3 }, // 4æ¡Ã·3æ¡
            ];

            const type = types[Math.floor(Math.random() * types.length)];

            // å‰²ã‚‹æ•°ã‚’ç”Ÿæˆ
            gameState.divisor = randomNumber(type.divisorDigits);

            // å•†ã‚’æ±ºã‚ã‚‹ï¼ˆ2ã€œ99ã®ç¯„å›²ï¼‰
            const quotient = Math.floor(Math.random() * 98) + 2;

            // ä½™ã‚Šã‚’æ±ºã‚ã‚‹ï¼ˆ0ã€œdivisor-1ã®ç¯„å›²ï¼‰
            const remainder = Math.floor(Math.random() * gameState.divisor);

            // å‰²ã‚‰ã‚Œã‚‹æ•° = å•† Ã— å‰²ã‚‹æ•° + ä½™ã‚Š
            gameState.dividend = quotient * gameState.divisor + remainder;
            gameState.correctAnswer = quotient;

            // UIæ›´æ–°
            document.getElementById('hpValue').textContent = gameState.dividend;
            document.getElementById('attackValue').textContent = gameState.divisor;
            document.getElementById('monsterIcon').textContent = monsters[Math.floor(Math.random() * monsters.length)];
            document.getElementById('answerInput').value = '';
            document.getElementById('answerInput').focus();
            document.getElementById('feedback').classList.remove('show');
        }

        // æŒ‡å®šæ¡æ•°ã®ãƒ©ãƒ³ãƒ€ãƒ ãªæ•°ã‚’ç”Ÿæˆ
        function randomNumber(digits) {
            const min = Math.pow(10, digits - 1);
            const max = Math.pow(10, digits) - 1;
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        // å›ç­”ãƒã‚§ãƒƒã‚¯
        function checkAnswer() {
            const input = document.getElementById('answerInput');
            gameState.userAnswer = parseInt(input.value);

            if (isNaN(gameState.userAnswer) || gameState.userAnswer < 1) {
                alert('æ•°å­—ã‚’å…¥åŠ›ã—ã¦ã­ï¼');
                return;
            }

            // å·®ã‚’è¨ˆç®—
            const diff = Math.abs(gameState.userAnswer - gameState.correctAnswer);

            // åˆ¤å®š
            let rank = '';
            let icon = '';
            let title = '';
            let message = '';
            let color = '';

            if (diff <= 1) {
                rank = 'perfect';
                icon = 'ğŸ‰';
                title = 'â— å®Œç’§ãªè¦‹ç«‹ã¦ï¼';
                message = 'ã™ã”ã„ï¼ã»ã¼æ­£ç¢ºã«è¦‹ç«‹ã¦ã‚‰ã‚ŒãŸã­ï¼';
                color = 'feedback-perfect';
                gameState.perfectCount++;
                gameState.combo++;
            } else if (diff <= 2) {
                rank = 'good';
                icon = 'ğŸ‘';
                title = 'â—‹ ã„ã„è¦‹ç«‹ã¦ï¼';
                message = 'ã„ã„æ„Ÿã˜ï¼ã‚‚ã†å°‘ã—ã§å®Œç’§ã ã‚ˆï¼';
                color = 'feedback-good';
                gameState.goodCount++;
                gameState.combo++;
            } else {
                rank = 'ok';
                icon = 'ğŸ’¡';
                title = 'â–³ ã‚‚ã†ä¸€æ¯ï¼';
                message = diff > 10 ? 'å¤§ããå¤–ã‚Œã¡ã‚ƒã£ãŸã­ã€‚ä¸¸ã‚ã¦è€ƒãˆã¦ã¿ã‚ˆã†ï¼' : 'ã‚‚ã†å°‘ã—æ­£ç¢ºã«è¦‹ç«‹ã¦ã¦ã¿ã‚ˆã†ï¼';
                color = 'feedback-ok';
                gameState.combo = 0;
            }

            gameState.totalCount++;

            // ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯è¡¨ç¤º
            document.getElementById('feedbackIcon').textContent = icon;
            document.getElementById('feedbackTitle').textContent = title;
            document.getElementById('feedbackTitle').className = `feedback-title ${color}`;
            document.getElementById('feedbackMessage').textContent = message;

            // è§£èª¬
            const explanation = `
                <strong>æ­£ã—ã„å•†ï¼š${gameState.correctAnswer}å›</strong><br>
                ã‚ãªãŸã®è¦‹ç«‹ã¦ï¼š${gameState.userAnswer}å›<br>
                ${gameState.dividend} Ã· ${gameState.divisor} = ${gameState.correctAnswer}ã‚ã¾ã‚Š${gameState.dividend % gameState.divisor}<br>
                <br>
                ğŸ’¡ è€ƒãˆæ–¹ã®ãƒ’ãƒ³ãƒˆï¼š<br>
                ${getRoundingHint()}
            `;
            document.getElementById('feedbackExplanation').innerHTML = explanation;
            document.getElementById('feedback').classList.add('show');

            // ã‚¹ã‚³ã‚¢æ›´æ–°
            updateScore();
            saveProgress();
        }

        // ä¸¸ã‚æ–¹ã®ãƒ’ãƒ³ãƒˆç”Ÿæˆ
        function getRoundingHint() {
            const dividendRounded = roundToFirstDigit(gameState.dividend);
            const divisorRounded = roundToFirstDigit(gameState.divisor);
            const roughAnswer = Math.floor(dividendRounded / divisorRounded);

            return `ã€Œ${gameState.dividend}ã€ã‚’ã€Œ${dividendRounded}ã€ã€ã€Œ${gameState.divisor}ã€ã‚’ã€Œ${divisorRounded}ã€ã¨è€ƒãˆã‚‹ã¨<br>
                    ${dividendRounded} Ã· ${divisorRounded} â‰’ ${roughAnswer}å› ãã‚‰ã„ã¨è¦‹ç«‹ã¦ã‚‰ã‚Œã‚‹ã‚ˆï¼`;
        }

        // æœ€ä¸Šä½æ¡ã«ä¸¸ã‚ã‚‹
        function roundToFirstDigit(num) {
            const digits = num.toString().length;
            const divisor = Math.pow(10, digits - 1);
            return Math.round(num / divisor) * divisor;
        }

        // ã‚¹ã‚³ã‚¢æ›´æ–°
        function updateScore() {
            document.getElementById('comboCount').textContent = gameState.combo;
            document.getElementById('perfectCount').textContent = gameState.perfectCount;
            document.getElementById('goodCount').textContent = gameState.goodCount;
            document.getElementById('totalCount').textContent = gameState.totalCount;
        }

        // æ¬¡ã®å•é¡Œ
        function nextProblem() {
            generateProblem();
        }

        // é€²æ—ä¿å­˜
        function saveProgress() {
            localStorage.setItem('divisionEstimation', JSON.stringify({
                perfectCount: gameState.perfectCount,
                goodCount: gameState.goodCount,
                totalCount: gameState.totalCount,
            }));
        }

        // é€²æ—èª­ã¿è¾¼ã¿
        function loadProgress() {
            const saved = localStorage.getItem('divisionEstimation');
            if (saved) {
                const data = JSON.parse(saved);
                gameState.perfectCount = data.perfectCount || 0;
                gameState.goodCount = data.goodCount || 0;
                gameState.totalCount = data.totalCount || 0;
                updateScore();
            }
        }

        // Enterã‚­ãƒ¼ã§é€ä¿¡
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('answerInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    checkAnswer();
                }
            });
        });
    </script>
</body>
</html>
